<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Turnaround Time Interactive Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- 
        Chosen Palette: Warm Neutrals (Slate, Zinc, Stone)
        Application Structure Plan: A single-page dashboard layout is used to provide a comprehensive and immediate overview of the TAT data. The core interaction is a set of toggle buttons at the top that switch the entire dashboard's context between the two key processes: "Evaluation to Dictation" (TAT1) and "Dictation to Upload" (TAT2). This structure was chosen because it allows for direct and easy comparison between the two workflows. The layout consists of three main parts: 1) High-level KPI cards for at-a-glance metrics (Average, Min, Max). 2) A central bar chart for visual comparison and quick identification of outliers. 3) A detailed, sortable data table for granular analysis. Additionally, a new "Add Entry" section is introduced at the top to allow users to dynamically input new data, enhancing the interactive nature of the dashboard. This tiered approach (data input -> summary -> visual -> detail) supports various user analysis needs within a single, cohesive view. A new "Select Provider" section allows for filtering the entire dashboard by specific providers.
        Visualization & Content Choices: 
        - Report Info: Summary statistics (Avg, Min, Max). Goal: Inform. Viz/Method: KPI Cards (HTML/Tailwind). Interaction: Dynamic update on view toggle. Justification: Provides immediate, high-level understanding of performance for the selected process.
        - Report Info: Individual claimant TAT data. Goal: Compare/Analyze. Viz/Method: Vertical Bar Chart (Chart.js/Canvas). Interaction: Tooltips on hover, dynamic data update on view toggle, color-coded bars based on TAT thresholds. Justification: Excellent for visually comparing performance across many individual cases and spotting outliers or trends more effectively than a simple table, with added visual cues for performance.
        - Report Info: Detailed TAT data per claimant. Goal: Detail/Lookup. Viz/Method: HTML Table. Interaction: Sortable columns, dynamic data update on view toggle, new delete row functionality, filtering by provider and date range. Justification: Allows users to find and examine specific records and sort the data based on different criteria (e.g., by name or by longest TAT), and now allows for removal and filtering of entries for more targeted analysis.
        - Report Info: New data entry. Goal: Input/Extend. Viz/Method: HTML Form (text and date inputs, button, provider dropdown). Interaction: User input, form submission, data validation, add to internal data arrays, dashboard refresh. Justification: Enables users to extend the dataset directly within the application for real-time analysis of new entries, now with provider assignment.
        - Report Info: Provider selection. Goal: Filter/Focus. Viz/Method: HTML Buttons/Dropdown. Interaction: Click to filter dashboard data. Justification: Allows users to focus on specific provider performance.
        - CONFIRMATION: NO SVG graphics used. NO Mermaid JS used.
    -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* slate-50 */
        }
        .kpi-card {
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .kpi-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -2px rgb(0 0 0 / 0.1);
        }
        .chart-container {
            position: relative;
            width: 100%;
            height: 400px;
            max-height: 50vh;
            background-color: white;
            padding: 1.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        .table-container {
            max-height: 400px;
            overflow-y: auto;
        }
        th {
            cursor: pointer;
            user-select: none;
        }
        th:hover {
            background-color: #f1f5f9; /* slate-100 */
        }
        .delete-btn {
            background-color: #ef4444; /* red-500 */
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 0.375rem;
            font-size: 0.75rem;
            line-height: 1rem;
            transition: background-color 0.2s ease-in-out;
        }
        .delete-btn:hover {
            background-color: #dc2626; /* red-600 */
        }
        .provider-filter-btn.active {
            background-color: #1e293b; /* slate-900 */
            color: white;
            border-color: #1e293b;
        }
    </style>
</head>
<body class="antialiased text-slate-800">

    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
        
        <header class="text-center mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-slate-900">Turnaround Time Interactive Dashboard</h1>
            <p class="text-slate-600 mt-2">Analyze report generation efficiency from evaluation to upload.</p>
        </header>

        <div class="flex justify-center mb-8">
            <div class="inline-flex rounded-lg shadow-sm" role="group">
                <button type="button" id="btn-tat1" class="bg-slate-800 text-white ring-2 ring-slate-800 font-semibold py-2 px-6 rounded-l-lg">
                    Evaluation to Dictation
                </button>
                <button type="button" id="btn-tat2" class="bg-white text-slate-800 hover:bg-slate-100 font-semibold py-2 px-6 rounded-r-lg">
                    Dictation to Upload
                </button>
            </div>
        </div>

        <main id="dashboard-content">
            <section class="bg-white p-6 rounded-lg shadow-sm mb-8">
                <h2 class="text-xl font-bold mb-4 text-slate-900">Add New Entry</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                    <div>
                        <label for="input-name" class="block text-sm font-medium text-slate-700">Name</label>
                        <input type="text" id="input-name" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-slate-500 focus:ring-slate-500 sm:text-sm p-2">
                    </div>
                    <div>
                        <label for="input-eval-date" class="block text-sm font-medium text-slate-700">Date of Evaluation</label>
                        <input type="date" id="input-eval-date" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-slate-500 focus:ring-slate-500 sm:text-sm p-2">
                    </div>
                    <div>
                        <label for="input-received-date" class="block text-sm font-medium text-slate-700">Date Dictation Received</label>
                        <input type="date" id="input-received-date" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-slate-500 focus:ring-slate-500 sm:text-sm p-2">
                    </div>
                    <div>
                        <label for="input-uploaded-date" class="block text-sm font-medium text-slate-700">Date Report Uploaded</label>
                        <input type="date" id="input-uploaded-date" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-slate-500 focus:ring-slate-500 sm:text-sm p-2">
                    </div>
                    <div class="lg:col-span-1">
                        <label for="input-provider" class="block text-sm font-medium text-slate-700">Assign Provider</label>
                        <select id="input-provider" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-slate-500 focus:ring-slate-500 sm:text-sm p-2">
                            <option value="Provider 1">Provider 1</option>
                            <option value="Provider 2">Provider 2</option>
                            <option value="Provider 3">Provider 3</option>
                        </select>
                    </div>
                </div>
                <button id="add-entry-btn" class="mt-6 bg-slate-800 text-white font-semibold py-2 px-6 rounded-lg hover:bg-slate-700 transition duration-200">
                    Add Entry
                </button>
                <p id="feedback-message" class="mt-4 text-sm"></p>
            </section>

            <section class="bg-white p-6 rounded-lg shadow-sm mb-8">
                <h2 class="text-xl font-bold mb-4 text-slate-900">Select Provider</h2>
                <div class="flex justify-center mb-4">
                    <div class="inline-flex rounded-lg shadow-sm" role="group">
                        <button type="button" id="filter-provider-all" class="provider-filter-btn bg-slate-800 text-white ring-2 ring-slate-800 font-semibold py-2 px-4 rounded-l-lg" data-provider="All Providers">
                            All Providers
                        </button>
                        <button type="button" id="filter-provider-1" class="provider-filter-btn bg-white text-slate-800 hover:bg-slate-100 font-semibold py-2 px-4" data-provider="Provider 1">
                            Provider 1
                        </button>
                        <button type="button" id="filter-provider-2" class="provider-filter-btn bg-white text-slate-800 hover:bg-slate-100 font-semibold py-2 px-4" data-provider="Provider 2">
                            Provider 2
                        </button>
                        <button type="button" id="filter-provider-3" class="provider-filter-btn bg-white text-slate-800 hover:bg-slate-100 font-semibold py-2 px-4 rounded-r-lg" data-provider="Provider 3">
                            Provider 3
                        </button>
                    </div>
                </div>
                <h2 class="text-xl font-bold mb-4 text-slate-900">Filters</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <div>
                        <label for="filter-name" class="block text-sm font-medium text-slate-700">Filter by Claimant Name</label>
                        <input type="text" id="filter-name" placeholder="e.g., Susana" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-slate-500 focus:ring-slate-500 sm:text-sm p-2">
                    </div>
                    <div>
                        <label for="filter-start-date" class="block text-sm font-medium text-slate-700">Start Date</label>
                        <input type="date" id="filter-start-date" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-slate-500 focus:ring-slate-500 sm:text-sm p-2">
                    </div>
                    <div>
                        <label for="filter-end-date" class="block text-sm font-medium text-slate-700">End Date</label>
                        <input type="date" id="filter-end-date" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-slate-500 focus:ring-slate-500 sm:text-sm p-2">
                    </div>
                </div>
                <button id="apply-filters-btn" class="mt-6 bg-slate-800 text-white font-semibold py-2 px-6 rounded-lg hover:bg-slate-700 transition duration-200">
                    Apply Filters
                </button>
                <button id="clear-filters-btn" class="mt-6 ml-4 bg-gray-200 text-slate-800 font-semibold py-2 px-6 rounded-lg hover:bg-gray-300 transition duration-200">
                    Clear Filters
                </button>
            </section>

            <section id="kpi-section" class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="kpi-card p-6 flex flex-col justify-between">
                    <h2 class="text-slate-500 font-medium">Average Turnaround</h2>
                    <p id="avg-tat" class="text-4xl font-bold text-slate-900 mt-2">0</p>
                </div>
                <div class="kpi-card p-6 flex flex-col justify-between">
                    <h2 class="text-slate-500 font-medium">Minimum Turnaround</h2>
                    <p id="min-tat" class="text-4xl font-bold text-green-600 mt-2">0</p>
                </div>
                <div class="kpi-card p-6 flex flex-col justify-between">
                    <h2 class="text-slate-500 font-medium">Maximum Turnaround</h2>
                    <p id="max-tat" class="text-4xl font-bold text-red-600 mt-2">0</p>
                </div>
            </section>
            
            <section class="grid grid-cols-1 xl:grid-cols-5 gap-8">
                <div class="xl:col-span-3">
                    <div class="chart-container">
                        <canvas id="tatChart"></canvas>
                    </div>
                </div>
                <div class="xl:col-span-2 bg-white p-6 rounded-lg shadow-sm">
                    <h2 class="text-xl font-bold mb-4 text-slate-900">Detailed Breakdown</h2>
                    <div class="table-container">
                        <table class="w-full text-left text-sm">
                            <thead class="bg-slate-50 border-b-2 border-slate-200 sticky top-0">
                                <tr id="table-header">
                                </tr>
                            </thead>
                            <tbody id="data-table">
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            
            let dataIdCounter = 0; // To assign unique IDs

            // Helper to assign IDs and initial providers to data
            function assignIdsAndProviders(data, providerNames) {
                return data.map((item, index) => {
                    if (!item.id) {
                        item.id = dataIdCounter++;
                    }
                    // Assign providers in a round-robin fashion for initial data
                    item.provider = providerNames[index % providerNames.length];
                    return item;
                });
            }

            const initialProviders = ['Provider 1', 'Provider 2', 'Provider 3'];

            let tat1Data = assignIdsAndProviders([
                { name: 'Gallegos, Susana', evalDateStr: 'June 04, 2025', receivedDateStr: 'June 05, 2025' },
                { name: 'Lopez, Steven', evalDateStr: 'June 04, 2025', receivedDateStr: 'June 05, 2025' },
                { name: 'Vasquez, Omar', evalDateStr: 'June 04, 2025', receivedDateStr: 'June 26, 2025' },
                { name: 'Sachs, Charles', evalDateStr: 'June 11, 2025', receivedDateStr: 'June 18, 2025' },
                { name: 'Gomez, Maria', evalDateStr: 'June 11, 2025', receivedDateStr: 'June 18, 2025' },
                { name: 'Lopez, Robert', evalDateStr: 'June 11, 2025', receivedDateStr: 'June 18, 2025' },
                { name: 'Mays, Gerald', evalDateStr: 'June 11, 2025', receivedDateStr: 'June 18, 2025' },
                { name: 'Longoria, Grace', evalDateStr: 'June 18, 2025', receivedDateStr: 'June 25, 2025' },
                { name: 'Coury Curtis', evalDateStr: 'June 18, 2025', receivedDateStr: 'July 01, 2025' },
                { name: 'Orozco, Maria', evalDateStr: 'June 18, 2025', receivedDateStr: 'June 25, 2025' },
                { name: 'Galleano, Melissa', evalDateStr: 'June 18, 2025', receivedDateStr: 'June 25, 2025' },
                { name: 'Vasquez, Tara', evalDateStr: 'June 26, 2025', receivedDateStr: 'July 01, 2025' },
                { name: 'Toscano, Kelly', evalDateStr: 'June 25, 2025', receivedDateStr: 'June 27, 2025' },
                { name: 'Vasquez, Omar', evalDateStr: 'June 04, 2025', receivedDateStr: 'June 27, 2025' },
                { name: 'Shields, Antwon', evalDateStr: 'July 01, 2025', receivedDateStr: 'July 01, 2025' },
                { name: 'Inge, Oswin', evalDateStr: 'June 25, 2025', receivedDateStr: 'July 01, 2025' },
                { name: 'Radgowski, Becky', evalDateStr: 'June 25, 2025', receivedDateStr: 'July 01, 2025' },
                { name: 'Franklin, Christopher', evalDateStr: 'July 02, 2025', receivedDateStr: 'July 10, 2025' },
                { name: 'Cox, Syreeta', evalDateStr: 'July 02, 2025', receivedDateStr: 'July 10, 2025' },
                { name: 'Namowicz, Caleb', evalDateStr: 'July 02, 2025', receivedDateStr: 'July 10, 2025' },
                { name: 'Sanchez, Peter', evalDateStr: 'July 16, 2025', receivedDateStr: 'July 22, 2025' },
                { name: 'Johnson, Jimmie', evalDateStr: 'July 16, 2025', receivedDateStr: 'July 22, 2025' },
                { name: 'Sanchez, Loreto', evalDateStr: 'July 23, 2025', receivedDateStr: 'July 29, 2025' },
                { name: 'Pabros, Ruby', evalDateStr: 'July 23, 2025', receivedDateStr: 'July 29, 2025' },
                { name: 'Haueisen, Heidi', evalDateStr: 'July 23, 2025', receivedDateStr: 'July 29, 2025' },
                { name: 'Mora, Mark', evalDateStr: 'July 23, 2025', receivedDateStr: 'July 29, 2025' },
                { name: 'Curtis, Nolan', evalDateStr: 'July 29, 2025', receivedDateStr: 'July 31, 2025' },
                { name: 'Rivera, Yvonne', evalDateStr: 'July 30, 2025', receivedDateStr: 'July 31, 2025' },
            ], initialProviders);

            let tat2Data = assignIdsAndProviders([
                { name: 'Gallegos, Susana', receivedDateStr: 'June 05, 2025', uploadedDateStr: 'June 19, 2025' },
                { name: 'Lopez, Steven', receivedDateStr: 'June 05, 2025', uploadedDateStr: 'June 16, 2025' },
                { name: 'Vasquez, Omar', receivedDateStr: 'June 26, 2025', uploadedDateStr: 'July 01, 2025' },
                { name: 'Sachs, Charles', receivedDateStr: 'June 18, 2025', uploadedDateStr: 'June 30, 2025' },
                { name: 'Gomez, Maria', receivedDateStr: 'June 18, 2025', uploadedDateStr: 'June 26, 2025' },
                { name: 'Lopez, Robert', receivedDateStr: 'June 18, 2025', uploadedDateStr: 'June 30, 2025' },
                { name: 'Mays, Gerald', receivedDateStr: 'June 18, 2025', uploadedDateStr: 'June 30, 2025' },
                { name: 'Longoria, Grace', receivedDateStr: 'June 25, 2025', uploadedDateStr: 'July 07, 2025' },
                { name: 'Orozco, Maria', receivedDateStr: 'June 25, 2025', uploadedDateStr: 'July 22, 2025' },
                { name: 'Galleano, Melissa', receivedDateStr: 'June 25, 2025', uploadedDateStr: 'July 22, 2025' },
                { name: 'Vasquez, Tara', receivedDateStr: 'July 01, 2025', uploadedDateStr: 'July 03, 2025' },
                { name: 'Toscano, Kelly', receivedDateStr: 'June 27, 2025', uploadedDateStr: 'July 11, 2025' },
                { name: 'Vasquez, Omar', receivedDateStr: 'June 27, 2025', uploadedDateStr: 'July 02, 2025' },
                { name: 'Shields, Antwon', receivedDateStr: 'July 01, 2025', uploadedDateStr: 'July 16, 2025' },
                { name: 'Inge, Oswin', receivedDateStr: 'July 01, 2025', uploadedDateStr: 'July 14, 2025' },
                { name: 'Radgowski, Becky', receivedDateStr: 'July 01, 2025', uploadedDateStr: 'July 10, 2025' },
                { name: 'Franklin, Christopher', receivedDateStr: 'July 10, 2025', uploadedDateStr: 'July 18, 2025' },
                { name: 'Cox, Syreeta', receivedDateStr: 'July 10, 2025', uploadedDateStr: 'July 18, 2025' },
                { name: 'Namowicz, Caleb', receivedDateStr: 'July 10, 2025', uploadedDateStr: 'July 17, 2025' },
                { name: 'Sanchez, Peter', receivedDateStr: 'July 22, 2025', uploadedDateStr: 'August 01, 2025' },
                { name: 'Johnson, Jimmie', receivedDateStr: 'July 22, 2025', uploadedDateStr: 'July 31, 2025' },
            ], initialProviders);
            
            let currentView = 'tat1';
            let currentSort = { column: 'days', order: 'desc' };
            let currentProviderFilter = 'All Providers'; // New state variable for provider filter
            
            const btnTat1 = document.getElementById('btn-tat1');
            const btnTat2 = document.getElementById('btn-tat2');
            
            const avgTatEl = document.getElementById('avg-tat');
            const minTatEl = document.getElementById('min-tat');
            const maxTatEl = document.getElementById('max-tat');
            
            const tableHeaderEl = document.getElementById('table-header');
            const dataTableEl = document.getElementById('data-table');

            // Input elements for adding new data
            const inputNameEl = document.getElementById('input-name');
            const inputEvalDateEl = document.getElementById('input-eval-date');
            const inputReceivedDateEl = document.getElementById('input-received-date');
            const inputUploadedDateEl = document.getElementById('input-uploaded-date');
            const inputProviderEl = document.getElementById('input-provider'); // New provider input
            const addEntryBtn = document.getElementById('add-entry-btn');
            const feedbackMessageEl = document.getElementById('feedback-message');

            // Filter elements
            const filterNameEl = document.getElementById('filter-name');
            const filterStartDateEl = document.getElementById('filter-start-date');
            const filterEndDateEl = document.getElementById('filter-end-date');
            const applyFiltersBtn = document.getElementById('apply-filters-btn');
            const clearFiltersBtn = document.getElementById('clear-filters-btn');
            const providerFilterButtons = document.querySelectorAll('.provider-filter-btn'); // New provider filter buttons


            const ctx = document.getElementById('tatChart').getContext('2d');
            let tatChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Turnaround Time (Days)',
                        data: [],
                        backgroundColor: [], // Will be dynamic
                        borderColor: [], // Will be dynamic
                        borderWidth: 1,
                        borderRadius: 4,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: { display: true, text: 'Days' }
                        },
                        x: {
                            ticks: {
                                autoSkip: false,
                                maxRotation: 90,
                                minRotation: 45
                            }
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return ` ${context.dataset.label}: ${context.parsed.y} days`;
                                }
                            }
                        }
                    }
                }
            });

            function formatDateForDisplay(dateString) {
                if (!dateString) return '';
                const date = new Date(dateString);
                if (isNaN(date.getTime())) return '';
                return date.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' });
            }

            function calculateDays(startDateStr, endDateStr) {
                const startDate = new Date(startDateStr);
                const endDate = new Date(endDateStr);
                if (isNaN(startDate.getTime()) || isNaN(endDate.getTime())) {
                    return NaN;
                }
                return (endDate - startDate) / (1000 * 60 * 60 * 24);
            }

            function getBarColor(days) {
                if (days < 7) {
                    return 'rgba(34, 197, 94, 0.8)'; // Green-500
                } else if (days >= 7 && days <= 14) {
                    return 'rgba(234, 179, 8, 0.8)'; // Yellow-500
                } else {
                    return 'rgba(239, 68, 68, 0.8)'; // Red-500
                }
            }

            function getBorderColor(days) {
                if (days < 7) {
                    return 'rgba(34, 197, 94, 1)'; // Green-500
                } else if (days >= 7 && days <= 14) {
                    return 'rgba(234, 179, 8, 1)'; // Yellow-500
                } else {
                    return 'rgba(239, 68, 68, 1)'; // Red-500
                }
            }

            function updateDashboard() {
                let data = currentView === 'tat1' ? [...tat1Data] : [...tat2Data]; // Use spread to create a shallow copy for filtering

                // Apply Provider Filter
                if (currentProviderFilter !== 'All Providers') {
                    data = data.filter(item => item.provider === currentProviderFilter);
                }

                // Apply Name Filter
                const nameFilterValue = filterNameEl.value.trim().toLowerCase();
                if (nameFilterValue) {
                    data = data.filter(item => item.name.toLowerCase().includes(nameFilterValue));
                }

                // Apply Date Range Filter
                const startDateFilterValue = filterStartDateEl.value;
                const endDateFilterValue = filterEndDateEl.value;

                if (startDateFilterValue && endDateFilterValue) {
                    const filterStartDate = new Date(startDateFilterValue);
                    const filterEndDate = new Date(endDateFilterValue);

                    data = data.filter(item => {
                        let itemDate;
                        if (currentView === 'tat1') {
                            itemDate = new Date(item.evalDateStr);
                        } else { // tat2
                            itemDate = new Date(item.receivedDateStr);
                        }
                        return itemDate >= filterStartDate && itemDate <= filterEndDate;
                    });
                }
                
                // Calculate 'days' for each item based on the current view
                const processedData = data.map(item => {
                    let daysValue = NaN;
                    if (currentView === 'tat1') {
                        daysValue = calculateDays(item.evalDateStr, item.receivedDateStr);
                    } else { // tat2
                        daysValue = calculateDays(item.receivedDateStr, item.uploadedDateStr);
                    }
                    return { ...item, days: daysValue };
                }).filter(item => !isNaN(item.days)); // Filter out entries with invalid date calculations

                const days = processedData.map(d => d.days);
                const avg = days.length > 0 ? days.reduce((a, b) => a + b, 0) / days.length : 0;
                const min = days.length > 0 ? Math.min(...days) : 0;
                const max = days.length > 0 ? Math.max(...days) : 0;

                avgTatEl.textContent = avg.toFixed(2);
                minTatEl.textContent = min;
                maxTatEl.textContent = max;
                
                sortData(processedData);
                
                updateChart(processedData);
                updateTable(processedData);
            }

            function updateChart(data) {
                const backgroundColors = data.map(item => getBarColor(item.days));
                const borderColors = data.map(item => getBorderColor(item.days));

                tatChart.data.labels = data.map(d => d.name);
                tatChart.data.datasets[0].data = data.map(d => d.days);
                tatChart.data.datasets[0].backgroundColor = backgroundColors;
                tatChart.data.datasets[0].borderColor = borderColors;
                tatChart.data.datasets[0].label = currentView === 'tat1' ? 'TAT (Evaluation to Dictation)' : 'TAT (Dictation to Upload)';
                tatChart.update();
            }

            function updateTable(data) {
                tableHeaderEl.innerHTML = '';
                dataTableEl.innerHTML = '';

                const headers = currentView === 'tat1' 
                    ? { name: 'Claimant', provider: 'Provider', evalDateStr: 'Eval Date', receivedDateStr: 'Received Date', days: 'TAT (Days)', actions: 'Actions' }
                    : { name: 'Claimant', provider: 'Provider', receivedDateStr: 'Received Date', uploadedDateStr: 'Uploaded Date', days: 'TAT (Days)', actions: 'Actions' };

                for (const key in headers) {
                    const th = document.createElement('th');
                    th.className = 'p-3 font-semibold text-slate-700';
                    th.textContent = headers[key];
                    if (key !== 'actions') { // Only sortable columns get sort attributes
                        th.dataset.sort = key;
                        if (key === currentSort.column) {
                            th.textContent += currentSort.order === 'asc' ? ' ▲' : ' ▼';
                        }
                    }
                    tableHeaderEl.appendChild(th);
                }

                data.forEach(item => {
                    const tr = document.createElement('tr');
                    tr.className = 'border-b border-slate-100 hover:bg-slate-50';
                    tr.dataset.id = item.id; // Store item ID on the row

                    for (const key in headers) {
                        const td = document.createElement('td');
                        td.className = 'p-3 text-slate-800';
                        if (key === 'actions') {
                            const deleteBtn = document.createElement('button');
                            deleteBtn.textContent = 'Delete';
                            deleteBtn.className = 'delete-btn';
                            deleteBtn.dataset.id = item.id; // Store item ID on the button
                            td.appendChild(deleteBtn);
                        } else {
                            td.textContent = item[key];
                        }
                        tr.appendChild(td);
                    }
                    dataTableEl.appendChild(tr);
                });
            }

            function sortData(data) {
                data.sort((a, b) => {
                    const valA = a[currentSort.column];
                    const valB = b[currentSort.column];
                    
                    let comparison = 0;
                    if (typeof valA === 'string' && typeof valB === 'string') {
                        comparison = valA.localeCompare(valB);
                    } else {
                        if (valA > valB) {
                            comparison = 1;
                        } else if (valA < valB) {
                            comparison = -1;
                        }
                    }
                    
                    return currentSort.order === 'desc' ? comparison * -1 : comparison;
                });
            }

            function addEntry() {
                const name = inputNameEl.value.trim();
                const evalDateInput = inputEvalDateEl.value; // YYYY-MM-DD
                const receivedDateInput = inputReceivedDateEl.value; // YYYY-MM-DD
                const uploadedDateInput = inputUploadedDateEl.value; // YYYY-MM-DD
                const provider = inputProviderEl.value; // Get selected provider

                // Validate inputs
                if (!name || !evalDateInput || !receivedDateInput || !uploadedDateInput || !provider) {
                    feedbackMessageEl.textContent = 'Please fill all fields.';
                    feedbackMessageEl.className = 'mt-4 text-sm text-red-600';
                    return;
                }

                const dateEval = new Date(evalDateInput);
                const dateReceived = new Date(receivedDateInput);
                const dateUploaded = new Date(uploadedDateInput);

                if (isNaN(dateEval.getTime()) || isNaN(dateReceived.getTime()) || isNaN(dateUploaded.getTime())) {
                    feedbackMessageEl.textContent = 'Invalid date format. Please use the date picker.';
                    feedbackMessageEl.className = 'mt-4 text-sm text-red-600';
                    return;
                }

                // Format dates for consistency with existing data strings
                const formattedEvalDate = formatDateForDisplay(evalDateInput);
                const formattedReceivedDate = formatDateForDisplay(receivedDateInput);
                const formattedUploadedDate = formatDateForDisplay(uploadedDateInput);

                const newId = dataIdCounter++;

                // Add to tat1Data
                tat1Data.push({
                    id: newId,
                    name: name,
                    provider: provider, // Add provider
                    evalDateStr: formattedEvalDate,
                    receivedDateStr: formattedReceivedDate
                });

                // Add to tat2Data
                tat2Data.push({
                    id: newId,
                    name: name,
                    provider: provider, // Add provider
                    receivedDateStr: formattedReceivedDate,
                    uploadedDateStr: formattedUploadedDate
                });

                // Clear inputs
                inputNameEl.value = '';
                inputEvalDateEl.value = '';
                inputReceivedDateEl.value = '';
                inputUploadedDateEl.value = '';
                inputProviderEl.value = 'Provider 1'; // Reset to default provider

                feedbackMessageEl.textContent = 'Entry added successfully!';
                feedbackMessageEl.className = 'mt-4 text-sm text-green-600';

                updateDashboard();
            }

            function deleteEntry(idToDelete) {
                // Filter out the entry from both data arrays
                tat1Data = tat1Data.filter(item => item.id !== idToDelete);
                tat2Data = tat2Data.filter(item => item.id !== idToDelete);
                
                feedbackMessageEl.textContent = 'Entry deleted successfully!';
                feedbackMessageEl.className = 'mt-4 text-sm text-green-600';

                updateDashboard(); // Re-render the dashboard with updated data
            }

            // Event delegation for delete buttons
            dataTableEl.addEventListener('click', (e) => {
                if (e.target.classList.contains('delete-btn')) {
                    const idToDelete = parseInt(e.target.dataset.id);
                    deleteEntry(idToDelete);
                }
            });

            tableHeaderEl.addEventListener('click', (e) => {
                if (e.target.tagName === 'TH' && e.target.dataset.sort) {
                    const sortKey = e.target.dataset.sort;
                    if (currentSort.column === sortKey) {
                        currentSort.order = currentSort.order === 'asc' ? 'desc' : 'asc';
                    } else {
                        currentSort.column = sortKey;
                        currentSort.order = 'desc';
                    }
                    updateDashboard();
                }
            });

            btnTat1.addEventListener('click', () => {
                if (currentView !== 'tat1') {
                    currentView = 'tat1';
                    btnTat1.classList.add('bg-slate-800', 'text-white', 'ring-2', 'ring-slate-800');
                    btnTat1.classList.remove('bg-white', 'text-slate-800', 'hover:bg-slate-100');
                    btnTat2.classList.add('bg-white', 'text-slate-800', 'hover:bg-slate-100');
                    btnTat2.classList.remove('bg-slate-800', 'text-white', 'ring-2', 'ring-slate-800');
                    updateDashboard();
                }
            });

            btnTat2.addEventListener('click', () => {
                if (currentView !== 'tat2') {
                    currentView = 'tat2';
                    btnTat2.classList.add('bg-slate-800', 'text-white', 'ring-2', 'ring-slate-800');
                    btnTat2.classList.remove('bg-white', 'text-slate-800', 'hover:bg-slate-100');
                    btnTat1.classList.add('bg-white', 'text-slate-800', 'hover:bg-slate-100');
                    btnTat1.classList.remove('bg-slate-800', 'text-white', 'ring-2', 'ring-slate-800');
                    updateDashboard();
                }
            });
            
            addEntryBtn.addEventListener('click', addEntry);
            applyFiltersBtn.addEventListener('click', updateDashboard);
            clearFiltersBtn.addEventListener('click', () => {
                filterNameEl.value = '';
                filterStartDateEl.value = '';
                filterEndDateEl.value = '';
                updateDashboard();
            });

            // New: Provider filter button event listeners
            providerFilterButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const provider = button.dataset.provider;
                    currentProviderFilter = provider;

                    // Update active button styling
                    providerFilterButtons.forEach(btn => {
                        btn.classList.remove('active', 'bg-slate-800', 'text-white', 'ring-2', 'ring-slate-800');
                        btn.classList.add('bg-white', 'text-slate-800', 'hover:bg-slate-100');
                    });
                    button.classList.add('active', 'bg-slate-800', 'text-white', 'ring-2', 'ring-slate-800');
                    button.classList.remove('bg-white', 'text-slate-800', 'hover:bg-slate-100');

                    updateDashboard();
                });
            });

            updateDashboard();
        });
    </script>
</body>
</html>
